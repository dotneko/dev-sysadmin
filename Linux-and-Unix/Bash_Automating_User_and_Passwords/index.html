<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Gavin">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Bash Automating User and Passwords - Software Development and System Administration Notes</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Bash Automating User and Passwords";
    var mkdocs_page_input_path = "Linux-and-Unix/Bash_Automating_User_and_Passwords.md";
    var mkdocs_page_url = "/Linux-and-Unix/Bash_Automating_User_and_Passwords/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-91170914-1', 'gavchan.github.io');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Software Development and System Administration Notes</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Linux and Unix</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../ArchLinux/">ArchLinux</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Bash Automating User and Passwords</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#simple-example-solaris">Simple Example (Solaris)</a></li>
    

    <li class="toctree-l3"><a href="#more-complex-example-solaris">More Complex Example (Solaris)</a></li>
    

    <li class="toctree-l3"><a href="#references">References:</a></li>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../FTP_Usage_and_Configuration/">FTP Usage and Configuration</a>
                </li>
                <li class="">
                    
    <a class="" href="../File_System/">File System</a>
                </li>
                <li class="">
                    
    <a class="" href="../Files_and_Directories/">Files and Directories</a>
                </li>
                <li class="">
                    
    <a class="" href="../Linux_Networking/">Linux Networking</a>
                </li>
                <li class="">
                    
    <a class="" href="../Naming_Services/">Naming Services</a>
                </li>
                <li class="">
                    
    <a class="" href="../Other_Distros/">Other Distros</a>
                </li>
                <li class="">
                    
    <a class="" href="../SSH_and_SCP_Usage/">SSH and SCP Usage</a>
                </li>
                <li class="">
                    
    <a class="" href="../Sharing_Files_with_Samba/">Sharing Files with Samba</a>
                </li>
                <li class="">
                    
    <a class="" href="../Solaris_Apache_Server_Setup_and_Config/">Solaris Apache Server Setup and Config</a>
                </li>
                <li class="">
                    
    <a class="" href="../Solaris_CheatSheet/">Solaris CheatSheet</a>
                </li>
                <li class="">
                    
    <a class="" href="../Solaris_Networking/">Solaris Networking</a>
                </li>
                <li class="">
                    
    <a class="" href="../Solaris_Roles/">Solaris Roles</a>
                </li>
                <li class="">
                    
    <a class="" href="../Solaris_SMB_vs_Samba/">Solaris SMB vs Samba</a>
                </li>
                <li class="">
                    
    <a class="" href="../Solaris_SMF/">Solaris SMF</a>
                </li>
                <li class="">
                    
    <a class="" href="../Ubuntu_Apache_Setup_and_Config/">Ubuntu Apache Setup and Config</a>
                </li>
                <li class="">
                    
    <a class="" href="../Users_and_Groups/">Users and Groups</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Miscellaneous</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../Miscellaneous/Git_and_GitHub/">Git and GitHub</a>
                </li>
                <li class="">
                    
    <a class="" href="../../Miscellaneous/Octave_Basics/">Octave Basics</a>
                </li>
                <li class="">
                    
    <a class="" href="../../Miscellaneous/Vim/">Vim</a>
                </li>
                <li class="">
                    
    <a class="" href="../../Miscellaneous/VirtualBox_Fixing_Error_Parent_UUID/">VirtualBox Fixing Error Parent UUID</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Powershell</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../Powershell/Functions_and_Scripting/">Functions and Scripting</a>
                </li>
                <li class="">
                    
    <a class="" href="../../Powershell/Installation_for_Linux_Mac/">Installation for Linux Mac</a>
                </li>
                <li class="">
                    
    <a class="" href="../../Powershell/Network_Configuration/">Network Configuration</a>
                </li>
                <li class="">
                    
    <a class="" href="../../Powershell/Powershell_Basics/">Powershell Basics</a>
                </li>
                <li class="">
                    
    <a class="" href="../../Powershell/Script_for_Automating_User_and_Group_Creation/">Script for Automating User and Group Creation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../Powershell/Windows_Firewall/">Windows Firewall</a>
                </li>
                <li class="">
                    
    <a class="" href="../../Powershell/Windows_Server_2012R2_Installation/">Windows Server 2012R2 Installation</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Python</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../Python/Databases_SQL_Python/">Databases SQL Python</a>
                </li>
                <li class="">
                    
    <a class="" href="../../Python/Python_OOP/">Python OOP</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Security</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../Security/Checksum_Integrity/">Checksum Integrity</a>
                </li>
                <li class="">
                    
    <a class="" href="../../Security/SSL-TLS/">SSL TLS</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Virtualization</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../Virtualization/Vagrant/">Vagrant</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">WebDev</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../WebDev/Resources/">Resources</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">WinServer2012</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../WinServer2012/Basic_Command_Line/">Basic Command Line</a>
                </li>
                <li class="">
                    
    <a class="" href="../../WinServer2012/Permissions/">Permissions</a>
                </li>
                <li class="">
                    
    <a class="" href="../../WinServer2012/Server_Roles/">Server Roles</a>
                </li>
                <li class="">
                    
    <a class="" href="../../WinServer2012/Sharing_Folders/">Sharing Folders</a>
                </li>
                <li class="">
                    
    <a class="" href="../../WinServer2012/User_Management/">User Management</a>
                </li>
                <li class="">
                    
    <a class="" href="../../WinServer2012/Windows_Server/">Windows Server</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Software Development and System Administration Notes</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Linux and Unix &raquo;</li>
        
      
    
    <li>Bash Automating User and Passwords</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/gavchan/dev-sysadmin/edit/master/docs/Linux-and-Unix/Bash_Automating_User_and_Passwords.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="simple-example-solaris">Simple Example (Solaris)</h1>
<p><strong><em>Task: Automate creation of users with a default password via a bash script</em></strong></p>
<ul>
<li>List of users are included in a <code>users.txt</code> containing usernames:</li>
</ul>
<pre><code>User1
User2
User3
User4
Test1
Test2
Test3
Test4
</code></pre>

<ul>
<li>Since the <code>passwd</code> command in Solaris does not have an <code>-stdin</code> option for standard input, an <strong>expect script</strong> needs to be created, which takes an argument for the username to create a password.</li>
<li>The password in this example = username+123, i.e. User1's password is User1123</li>
<li>For example, <code>userpass.exp</code>:</li>
</ul>
<pre><code>#!/bin/expect
set tag 123
set password $argv$tag
spawn passwd $argv
expect &quot;Password:&quot;
send &quot;$password\r&quot;;
expect &quot;Password:&quot;
send &quot;$password\r&quot;;
interact
</code></pre>

<ul>
<li>Now a bash script could be created to create a new user account and run the expect script to create a default password.</li>
<li>For example, <code>user-pass.sh</code>:</li>
</ul>
<pre><code>#!/bin/bash
for i in $(cat users.txt)
do
  useradd -m $i             # Creates a user
  ./userpass.exp $i         # Runs the expect script to add the password
done
exit
</code></pre>

<ul>
<li>To run, execute <code>./users-pass.sh</code> as root.</li>
<li>Reference: - <a href="http://www.admin-magazine.com/Articles/Automating-with-Expect-Scripts">Using Expect Scripts to Automate Tasks</a></li>
</ul>
<h1 id="more-complex-example-solaris">More Complex Example (Solaris)</h1>
<p><strong><em>Task: To automatically create user accounts from a text file with additional information.</em></strong></p>
<ul>
<li>N.B. <a href="https://github.com/gavchan/sol-scripts">Scripts below pushed to github repository</a></li>
<li>E.g. <code>userslist.txt</code> file contains usernames and passwords, first and last names:</li>
</ul>
<pre><code>user1 password1 User1 Last1
user2 password2 User2 Last2
user3 password3 User3 Last3
user4 password4 User4 Last4
test1 password1 Test1 Last1
test2 password2 Test2 Last2
test3 password3 Test3 Last3
test4 password4 Test4 Last4
</code></pre>

<p>A simple expect script <code>userpass.exp</code> to enter <argv> as password:</p>
<pre><code>#!/bin/expect
set username [lindex $argv 0]
set password [lindex $argv 1]
spawn passwd $username
set sp_id $spawn_id
expect &quot;Password:&quot;
send &quot;$password\r&quot;;
expect &quot;Password:&quot;
send &quot;$password\r&quot;;
wait $spawn_id
close
</code></pre>

<ul>
<li>N.B. For some reason closing with <code>interact</code> didn't work like the first script, so instead used <code>wait</code> to allow the <code>passwd</code> process to finish, then <code>close</code>.</li>
</ul>
<p>A bash script to read the <code>userslist.txt</code> file and create users with necessary info, <code>create-users.sh</code>:</p>
<pre><code>#!/bin/bash
echo &quot;Creating users from file userslist.txt&quot;
while IFS=&quot; &quot; read col1 col2 col3 col4
do
  echo &quot;Creating account $col1 for $col3 $col4&quot;.
  useradd -m -c &quot;$col3 $col4&quot; $col1
  echo &quot;Password for username $col1 is: $col2&quot;
  ./userpass.exp $col1 $col2
done &lt; userlist.txt
exit
</code></pre>

<h1 id="references">References:</h1>
<ul>
<li><a href="http://stackoverflow.com/questions/4286469/how-to-parse-a-csv-file-in-bash">How to parse a CSV file in Bash</a></li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../FTP_Usage_and_Configuration/" class="btn btn-neutral float-right" title="FTP Usage and Configuration">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../ArchLinux/" class="btn btn-neutral" title="ArchLinux"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/gavchan/dev-sysadmin/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../ArchLinux/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../FTP_Usage_and_Configuration/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../../js/theme.js"></script>

</body>
</html>
